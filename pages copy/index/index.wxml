<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="top-nav">
    <text class="nav-title">åºé™µå‰æˆæ³•ç­”</text>
    <view class="nav-right" bindtap="goToUserCenter">
      <text class="nav-icon">ğŸ‘¤</text>
      <text class="nav-text">æˆ‘çš„</text>
    </view>
  </view>

  <!-- èŠå¤©æ¶ˆæ¯åŒºåŸŸ -->
  <scroll-view
    class="chat-area"
    scroll-y
    scroll-into-view="{{scrollToView}}"
    scroll-with-animation>

    <!-- æ¬¢è¿æ¶ˆæ¯ -->
    <view class="message-row assistant-row" wx:if="{{messages.length === 0}}">
      <view class="message-content assistant-message welcome-message">
        <text class="message-text">æ‚¨å¥½ï¼æˆ‘æ˜¯ç‹å‰æˆå¾‹å¸ˆçš„AIåŠ©æ‰‹ ğŸ‘‹

ä¸“ä¸šè§£ç­”ï¼šåŠ³åŠ¨çº çº·ã€åˆåŒå®¡æŸ¥ã€å©šå§»å®¶åº­ã€æ°‘äº‹çº çº·ç­‰æ³•å¾‹é—®é¢˜

ä»Šæ—¥å‰©ä½™æ¬¡æ•°ï¼š{{remainingCount}}æ¬¡

è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„ï¼Ÿ
        </text>
      </view>
    </view>

    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <block wx:for="{{messages}}" wx:key="id">
      <!-- ç”¨æˆ·æ¶ˆæ¯ -->
      <view class="message-row user-row" id="msg-{{item.id}}" wx:if="{{item.role === 'user'}}">
        <view class="message-content user-message">
          <text class="message-text">{{item.content}}</text>
        </view>
        <image class="avatar user-avatar" src="{{userAvatar || 'https://i.ibb.co/kYn16mr/user-avatar.png'}}" mode="aspectFill"></image>
      </view>

      <!-- åŠ©æ‰‹æ¶ˆæ¯ -->
      <view class="message-row assistant-row" id="msg-{{item.id}}" wx:else>
        <image class="avatar assistant-avatar" src="https://i.ibb.co/HfcLSTct/assistant-avatar.png" mode="aspectFit"></image>
        <view class="message-content assistant-message">
          <text class="message-text">{{item.content}}</text>
        </view>
      </view>
    </block>

    <!-- åŠ è½½æç¤º -->
    <view class="message-row assistant-row" wx:if="{{loading}}">
      <image class="avatar assistant-avatar" src="https://i.ibb.co/HfcLSTct/assistant-avatar.png" mode="aspectFit"></image>
      <view class="message-content assistant-message loading">
        <view class="typing-dots">
          <view class="dot"></view>
          <view class="dot"></view>
          <view class="dot"></view>
        </view>
      </view>
    </view>

    <!-- æ‰“å­—å…‰æ ‡æ•ˆæœ -->
    <view class="message-row assistant-row" wx:if="{{messages.length > 0 && messages[messages.length-1].isTyping}}">
      <image class="avatar assistant-avatar" src="https://i.ibb.co/HfcLSTct/assistant-avatar.png" mode="aspectFit"></image>
      <view class="message-content assistant-message">
        <text class="message-text">{{messages[messages.length-1].content}}<text class="cursor">|</text></text>
      </view>
    </view>
  </scroll-view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-area">
    <view class="input-box">
      <textarea
        class="input-field"
        value="{{inputText}}"
        bindinput="onInputChange"
        bindconfirm="sendMessage"
        confirm-type="send"
        placeholder="è¯·è¾“å…¥æ‚¨çš„æ³•å¾‹é—®é¢˜..."
        placeholder-class="input-placeholder"
        auto-height
        maxlength="1000"
        adjust-position="{{true}}"
        show-confirm-bar="{{false}}"
      />
      <button
        class="send-button {{hasInput ? 'active' : ''}}"
        bindtap="sendMessage"
        disabled="{{!hasInput || loading}}"
      >
        å‘é€
      </button>
    </view>
  </view>
</view>
