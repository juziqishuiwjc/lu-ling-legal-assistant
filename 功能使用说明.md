# 庐陵吉成法答 - 功能使用说明

## 📱 新增功能概览

本次更新为您添加了完整的用户管理和管理后台系统，包括：

### 1. **用户中心页面** 🙋‍♂️
- 查看个人账号状态
- 查看每日使用次数
- 设置手机号后8位
- 会员信息展示（会员类型、开通时间、到期日期、剩余天数）
- 快速跳转升级会员
- 联系律师

### 2. **管理后台页面** 👨‍⚖️
- 密码保护机制
- 隐藏入口设计
- 激活付费用户
- 查看已激活用户列表
- 搜索用户
- 数据统计

---

## 🚀 使用流程

### 用户端流程

#### 第一步：用户设置手机号
1. 在首页点击右上角「我的」按钮
2. 进入个人中心页面
3. 点击「设置手机号后8位」
4. 输入8位数字（例如：12345678）
5. 确认设置

#### 第二步：用户联系律师付款
1. 在个人中心点击「立即升级」
2. 或在首页超出次数限制时自动跳转
3. 查看套餐价格（月付¥99 或 年付¥996）
4. 点击「联系王律师开通」
5. 微信号会自动复制到剪贴板
6. 添加微信：lawyer_wang_zz
7. 转账相应金额
8. 备注：手机号后8位

#### 第三步：律师激活用户
1. 王吉成律师收到转账后，记录用户手机号后8位
2. 进入管理后台（长按页面最底部的版本号）
3. 输入管理员密码
4. 输入用户的手机号后8位
5. 选择套餐类型（月付/年付）
6. 点击「确认激活」

#### 第四步：用户自动激活
- 用户下次打开小程序时，系统会自动检测激活状态
- 如果手机号匹配，自动开通会员权限
- 无限制使用法律咨询服务

---

## 🔐 管理后台使用说明

### 访问管理后台

**隐藏入口（唯一方式）**
- 在「个人中心」页面
- 滚动到页面最底部
- 长按版本号"庐陵吉成法答 v1.0.0"
- 输入管理员密码：`wangjicheng2024`
- 验证成功后自动跳转到管理后台

> 📝 **密码修改方法**：详见《管理后台密码和隐藏入口说明.md》

### 激活用户步骤

1. **输入手机号**
   - 在「用户手机号后8位」输入框
   - 输入用户提供的8位数字

2. **选择套餐**
   - 点击「月付」或「年付」
   - 月付：¥99/月
   - 年付：¥996/年

3. **确认激活**
   - 点击「确认激活」按钮
   - 系统会弹出确认对话框
   - 点击「确认」完成激活

### 查看已激活用户

- **搜索功能**：在搜索框输入手机号后8位
- **用户列表**：显示所有已激活用户
  - 手机号（脱敏显示）
  - 套餐类型（月付/年付）
  - 激活时间

### 数据统计

- **总用户数**：包含免费和付费用户
- **付费用户**：已激活的会员数量
- **年付用户**：选择年付套餐的用户数

---

## ⚙️ 技术说明

### 数据存储

所有数据存储在**微信小程序本地存储**中：

| 键名 | 类型 | 说明 |
|------|------|------|
| `userInfo` | Object | 用户信息（手机号、付费状态、会员信息等） |
| `user_activations` | Array | 已激活用户列表 |

**用户信息结构**：
```javascript
{
  phone: '12345678',           // 手机号后8位
  isRegistered: false,         // 是否已注册
  isPaid: false,              // 是否已付费
  planType: 'monthly',        // 会员类型：monthly/yearly
  registerDate: '2026-01-02', // 注册日期
  paidDate: '2026-01-02',     // 付费日期
  expireDate: '2026-02-02',   // 到期日期
  dailyCount: 3,              // 今日已使用次数
  lastDate: '2026-01-02',     // 上次使用日期
  totalQuestions: 15          // 总提问次数
}
```

**注意**：由于使用本地存储，数据仅保存在用户设备上。如果用户清除缓存，数据会丢失。

### 激活原理

```
用户设置手机号 → 保存到 userInfo.phone (手机号后8位)
                ↓
律师激活用户 → 保存到 user_activations 数组
                ↓
用户打开小程序 → checkUserActivation() 检测
                ↓
匹配成功 → 更新用户付费状态 → 计算到期日期 → 开通会员
```

---

## 📋 页面结构

```
pages/
├── index/               # 首页（聊天界面）
│   ├── index.wxml      # 添加了顶部导航栏
│   ├── index.wxss      # 导航样式
│   └── index.js        # 添加跳转功能
├── user-center/        # 用户中心（新页面）
│   ├── user-center.wxml
│   ├── user-center.wxss
│   ├── user-center.js
│   └── user-center.json
├── upgrade/            # 升级页面
└── admin/              # 管理后台（新页面）
    ├── admin.wxml
    ├── admin.wxss
    ├── admin.js
    └── admin.json
```

---

## 🎯 关键代码位置

### app.js
- **新增**：`phone` 字段到用户数据（手机号后8位）
- **新增**：`planType` 和 `expireDate` 字段（会员类型和到期日期）
- **新增**：`checkUserActivation()` 函数
  - 在应用启动时自动检测激活状态
  - 比对手机号后8位
  - 自动更新付费状态
  - 计算会员到期日期
- **新增**：`checkMembershipExpire()` 函数
  - 检查会员是否过期
  - 过期自动取消会员资格
- **新增**：`calculateExpireDate()` 函数
  - 根据套餐类型计算到期日期
  - 月付：+30天，年付：+365天

### pages/index/index.js
- **新增**：`goToUserCenter()` 函数
  - 跳转到用户中心页面
- **优化**：超出次数限制自动跳转升级页面
  - 不显示确认弹窗
  - 直接跳转，体验更流畅

### pages/user-center/user-center.js
- **功能**：显示用户信息和使用统计
- **功能**：设置手机号后8位
- **新增**：会员信息卡片显示
  - 会员类型（月付/年付）
  - 开通时间
  - 到期日期
  - 剩余天数
- **新增**：点击头像也可以设置手机号
- **新增**：`calculateRemainingDays()` 函数
  - 计算会员剩余天数
  - 显示"剩余X天"、"今天到期"或"已到期"
- **安全**：密码保护的管理后台入口
  - 长按底部版本号触发
  - 密码验证机制

### pages/admin/admin.js
- **功能**：激活付费用户
- **功能**：查看已激活用户列表
- **功能**：搜索和统计数据
- **优化**：激活时自动计算并保存到期日期
- **优化**：更新套餐时重新计算到期日期

---

## 💡 注意事项

### 安全性
1. ✅ 管理后台密码保护
2. ✅ 隐藏入口设计，普通用户无法发现
3. ⚠️ 当前使用本地存储，用户可以手动修改数据
4. ⚠️ 建议后续使用云开发或后端服务器验证
5. ✅ 作为个人小程序，当前方案已足够

### 用户体验
1. ✅ 用户激活流程简单明了
2. ✅ 管理员操作便捷安全
3. ✅ 自动检测激活状态，无需用户操作
4. ✅ 会员信息完整展示
5. ✅ 到期自动检测和提示

### 后续优化建议
1. 使用微信云开发存储数据
2. 添加会员到期提醒功能
3. 添加使用记录统计
4. 添加会员续费功能

---

## 🔧 测试步骤

### 测试激活流程

1. **模拟用户操作**
   ```
   打开小程序 → 点击「我的」 → 设置手机号（如：12345678）
   ```

2. **模拟律师操作**
   ```
   滚动到页面底部 → 长按版本号"庐陵吉成法答 v1.0.0"
   输入密码：wangjicheng2024
   输入手机号：12345678
   选择套餐：月付
   点击确认激活
   ```

3. **验证激活成功**
   ```
   返回首页 → 点击「我的」
   查看状态：应显示「专业版会员」
   查看会员信息：应显示会员类型、开通时间、到期日期、剩余天数
   ```

4. **测试付费功能**
   ```
   返回首页 → 查看剩余次数
   应显示：「无限」
   ```

---

## 📞 联系方式

如有问题，请联系王吉成律师：
- 微信号：lawyer_wang_zz
- 小程序：庐陵吉成法答

---

**祝您使用愉快！** 🎉
